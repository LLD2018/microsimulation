\section{Introduction}

The software in question, microsimulation \cite{microsimulation},
implements a probabilistic discrete event simulation (DES), on a
person level (microsimulation). It simulates the incidence and development of prostate cancer
in men from the age 35 and above. This is called a natural history
model and can then be used to investigate effects of different health
care policies (such as screening of the population) or the effect of
better diagnostic markers.

By generating a population, and performing the microsimulation \citep{gulati_calibrating_2010},
i.e., follow each person (unit) over their life span, and then
aggregating the outcome in different predefined categories, the effect of
different policies can be evaluated. This fulfills the criteria of the
MapReduce programming model \cite{MapReduce:2004}, where the
simulation is the map step, and the sorting into different categories
is the reduction step.

The software has developed over long time, the first version was
implemented in C, this version in C++. It does pre- and post-processing
in R, and uses the Rcpp \citep{rcpp} package to interact with the C++
simulation engine. If we can reduce the execution time, and/or
increase the sample size, different policies can be evaluated, and
better accuracy obtained.

We chose to first adapt the code to use \texttt{openMP} to see if any
improvements could be achieved, and if time permitted, \texttt{openMP}
and \texttt{MPI} as a hybrid solution. The first in order to decrease
the execution time, and the second to allow for much larger sample
sizes. We spent most of our efforts adapting the code to
\texttt{openMP} and then made a simple \texttt{MPI} implementation for
the hybrid solution. 

\section{Environment}
\subsection{Hardware}
Due to allocation and software requirements we did the development and
profiling on Ferlin. Ferlin has two quad-core 2.2GHz processors per
node and a maximum of 16 nodes per job.

\subsection{Software}
For the \texttt{openMP} implementation we loaded
\texttt{gcc/4.8.1} and \texttt{R/3.0.2}. We wanted a recent
\texttt{gcc} version to support \texttt{openMP} and \texttt{C++11} and needed a recent R
version for the R/C++ interaction via Rcpp. A quirk we noticed, when
loading the modules, was that the \texttt{gcc} module needed to be loaded before
the R module, otherwise R would load an earlier version of \texttt{gcc}.

For the \texttt{MPI} implementation we used
\texttt{openmpi/1.4.1-intel}, which was the default \texttt{MPI}
module on Ferlin.




% Currently Loaded Modulefiles:
%  1) easy/1.8.ferlin(default)     6) mpi/ferlin(default)         
%  2) i-cce/11.1                   7) gcc/4.8.1                   
%  3) i-fce/11.1                   8) openmpi/1.5.4-gcc-4.6       
%  4) i-compilers/11.1             9) R/3.0.2                     
%  5) openmpi/1.4.1-intel(default)


% % Description of the package and its architecture.
% Purpose 
% Package to perform so called microsimulation. Sample population is
% generated, using a probalistic model of prostate cancer, follows
% persons (micro unit). Implementing different so called policies
% regarding screening, treatment, and try to evaluate their effect in
% terms of survival rates, cost for health care and so forth.


% % Technical
% Invoked from R. Fulfills the map-reduce computational
% model/paradigm. (Describe how it fulfills the map-reduce paradigm).
% Reduce step is ensemble averages (c.f., micro vs. macro states in
% statistical physics; Sample population generation -> apply operation
% rules (map step), collect statistics according to the defined criteria
% (reduce step)).

% % Aim
% Shorten execution time drastically to be able to try out a large
% amount of different policies. Want to be able to run larger
% models. First aim, OpenMp, second aim means MPI or equivalent, i.e..


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "report"
%%% End:
